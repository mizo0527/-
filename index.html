<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ãƒŠãƒ³ãƒ—ãƒ¬æŒ‘æˆ¦ï½œè¡£æ–™å“å£²å ´é™å®š</title>
<style>
  *{ box-sizing:border-box; }
  html, body{ margin:0; padding:0; overflow-x:hidden; }

  body{
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;
    background:#f6f7fb;
    color:#111;
  }
  .wrap{max-width:900px;margin:0 auto;padding:18px}
  .card{background:#fff;border-radius:16px;box-shadow:0 6px 18px rgba(0,0,0,.08);padding:16px;margin:14px 0}
  h1{font-size:20px;margin:0 0 6px}
  .sub{color:#444;font-size:13px;line-height:1.6;margin:0}
  .notice{font-size:13px;line-height:1.7;background:#fff7e6;border:1px solid #ffd18a;border-radius:12px;padding:12px}

  /* ç›¤é¢ */
  .grid{
    display:grid;
    grid-template-columns:repeat(9,1fr);
    gap:0;
    width:100%;
    max-width:100%;
    margin:0 auto;
    border:3px solid #111;
  }
  .cell{
    width:100%;
    aspect-ratio:1/1;
    background:#fff;
    border:1px solid #cfd3da;
    min-width:0;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .cell.thickL{ border-left:3px solid #111; }
  .cell.thickR{ border-right:3px solid #111; }
  .cell.thickT{ border-top:3px solid #111; }
  .cell.thickB{ border-bottom:3px solid #111; }

  input{
    width:100%;height:100%;
    border:0;outline:none;
    text-align:center;
    font-size:18px;
    background:transparent;
  }
  input.given{font-weight:700;color:#111}
  input.err{background:#ffe7e7}

  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  button{border:0;border-radius:12px;padding:10px 14px;background:#111;color:#fff;font-weight:700;cursor:pointer}
  button.sec{background:#e9ecf3;color:#111}
  .row button{ flex:1 1 140px; min-width:140px; }
  .msg{font-size:14px;line-height:1.7;margin-top:10px}

  .okBox{display:none;background:#eaffea;border:1px solid #9be39b;border-radius:14px;padding:14px;margin-top:12px}
  .okTitle{font-size:18px;font-weight:900;margin:0 0 6px}
  .small{font-size:12px;color:#444}

  .couponBox{
    border:2px dashed #111;
    border-radius:16px;
    padding:16px;
    text-align:center;
    animation:breathe 1.6s ease-in-out infinite;
  }
  @keyframes breathe{
    0%,100%{ transform:scale(1); }
    50%{ transform:scale(1.01); }
  }

  .couponAnim{
    position:relative;
    height:10px;
    border-radius:999px;
    overflow:hidden;
    background:#e9ecf3;
    border:1px solid #cfd3da;
    margin-top:12px;
  }
  .couponAnim .shine{
    position:absolute; inset:0;
    background:linear-gradient(90deg,
      rgba(0,0,0,0) 0%,
      rgba(0,0,0,0.25) 45%,
      rgba(0,0,0,0) 90%);
    transform:translateX(-100%);
    animation:slideShine 1.2s linear infinite;
  }
  @keyframes slideShine{ to{ transform:translateX(100%); } }

  @media (max-width:520px){
    .wrap{max-width:100%;padding:10px}
    h1{font-size:18px}
    .card{padding:12px}
    button{font-size:16px;padding:12px}
    input{font-size:20px;font-weight:600;}
    .grid{touch-action:manipulation;}
  }
</style>

</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ãƒŠãƒ³ãƒ—ãƒ¬æŒ‘æˆ¦ï¼ˆè§£ã‘ãŸã‚‰å£²å ´ã®äººã«å£°ã‹ã‘ã¦ï¼ï¼‰</h1>
      <p class="sub">
        ã‚¯ãƒªã‚¢ç”»é¢ã‚’è¡£æ–™å“å£²å ´ã‚¹ã‚¿ãƒƒãƒ•ã«è¦‹ã›ãŸã‚‰ã€<b>å¯¾è±¡å•†å“ãŒ2å‰²</b>ã«ãªã‚Šã¾ã™ã€‚<br/>
        â€»å¯¾è±¡ã¯<b>è¡£æ–™å“å£²å ´ã®æŒ‡å®šå•†å“</b>ã®ã¿ï¼å‰²å¼•æ¡ä»¶ã¯åº—èˆ—é‹ç”¨ã«æº–ã˜ã¾ã™
      </p>
    </div>

    <div class="card notice">
      <b>ãƒ«ãƒ¼ãƒ«ï¼ˆç°¡æ˜“ï¼‰</b><br/>
      1ã€œ9ã‚’ã€ç¸¦ãƒ»æ¨ªãƒ»3Ã—3ãƒ–ãƒ­ãƒƒã‚¯ãã‚Œãã‚Œã«é‡è¤‡ãªãå…¥ã‚Œã¦ãã ã•ã„ã€‚<br/>
      <span class="small">â€»ã“ã®ãƒšãƒ¼ã‚¸ã¯é€šä¿¡ä¸è¦ã€‚åº—å†…ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã‚„ã‚¹ãƒãƒ›ã§ã‚‚OKã€‚</span>
    </div>

<div class="card">
  <div id="board" class="grid" aria-label="sudoku board"></div>

  <div class="row" style="margin-top:12px">
    <button id="checkBtn">å®Œæˆãƒã‚§ãƒƒã‚¯</button>
    <button id="resetBtn" class="sec">ã‚„ã‚Šç›´ã—</button>
    <button id="hintBtn" class="sec">ãƒ’ãƒ³ãƒˆï¼ˆ1ãƒã‚¹ï¼‰</button>
  </div>

  <div id="status" class="msg"></div>

 <div id="okBox" class="okBox" role="status" aria-live="polite">
  <div class="couponBox">
    <p class="okTitle">ğŸ‰ ã‚¯ãƒªã‚¢ï¼ãŠã¤ã‹ã‚Œã•ã‚“ã§ï¼</p>

    <div style="margin-top:10px">
      è¡£æ–™å“å£²å ´ã®ã‚¹ã‚¿ãƒƒãƒ•ã«<br>
      <b>ã“ã®ç”»é¢</b>ã‚’è¦‹ã›ã¦ãªï¼ã‚ˆã‚ã—ãã§ï¼
    </div>

    <div style="margin-top:10px;font-size:18px;font-weight:bold">
      å¯¾è±¡å•†å“ 2å‰²å¼•
    </div>

    <div class="small">
      èªè¨¼ç•ªå·ï¼š<b id="randNum"></b>
    </div>

    <div class="small">
      ç™ºè¡Œæ—¥ï¼š<b id="issueDate"></b>
    </div>

    <div style="margin-top:10px;font-size:20px;font-weight:bold">
  æœ¬æ—¥ã®ã‚³ãƒ¼ãƒ‰ï¼š<span id="dayCode"></span>
</div>

    <div class="small">
      ç¾åœ¨æ™‚åˆ»ï¼š<b id="liveClock"></b>
    </div>
<div style="margin-top:10px">
  <div class="small">â–¶ ã‚¹ãƒ©ã‚¤ãƒ‰ã—ã¦ã‚¯ãƒ¼ãƒãƒ³æœ‰åŠ¹</div>
  <input type="range" id="unlockSlider" min="0" max="100" value="0" style="width:100%">
  <div id="unlockMsg" class="small" style="margin-top:6px;color:#888">
    ã‚¹ãƒ©ã‚¤ãƒ‰ã§æœ‰åŠ¹åŒ–ã—ã¦ãª
  </div>
</div>
    
    <div class="couponAnim"><span class="shine"></span></div>

    <div class="small" style="margin-top:10px">
      â€»åŸå‰‡å½“æ—¥é™å®šï¼ˆã‚¹ã‚¯ã‚·ãƒ§ã¯ç¿Œæ—¥ã¾ã§å¯¾å¿œï¼‰
    </div>
  </div>
</div>

    <div class="card">
  <div class="small">
 </div> <!-- â† ç›¤é¢ã‚«ãƒ¼ãƒ‰ã®é–‰ã˜ -->
      
    æ³¨æ„äº‹é …ï¼š<br/>
    ãƒ»ãƒŠãƒ³ãƒ—ãƒ¬ã¯1æ—¥3å›ã¾ã§ï¼ˆ1ç«¯æœ«ã‚ãŸã‚Šï¼‰<br/>
    ãƒ»å‰²å¼•ã‚¯ãƒ¼ãƒãƒ³è¡¨ç¤ºã¯15åˆ†ä»¥å†…<br/>
    ãƒ»ã‚¹ã‚¿ãƒƒãƒ•ç¢ºèªæ™‚ã¯ç”»é¢æç¤ºã‚’ãŠé¡˜ã„ã—ã¾ã™
  </div>
</div>
  
<script>

  // ===== ã‚µãƒ³ãƒ—ãƒ«å•é¡Œï¼ˆ0ã¯ç©ºæ¬„ï¼‰ =====
  // ã“ã‚Œã¯ä¾‹ã€‚è‡ªåˆ†ã®å•é¡Œã«å·®ã—æ›¿ãˆOKã€‚
  const puzzle = [
    [0,0,0, 2,6,0, 7,0,1],
    [6,8,0, 0,7,0, 0,9,0],
    [1,9,0, 0,0,4, 5,0,0],

    [8,2,0, 1,0,0, 0,4,0],
    [0,0,4, 6,0,2, 9,0,0],
    [0,5,0, 0,0,3, 0,2,8],

    [0,0,9, 3,0,0, 0,7,4],
    [0,4,0, 0,5,0, 0,3,6],
    [7,0,3, 0,1,8, 0,0,0]
  ];

  // å¯¾å¿œã™ã‚‹è§£ç­”ï¼ˆå®Œå…¨ä¸€è‡´ãƒã‚§ãƒƒã‚¯ç”¨ï¼‰
  const solution = [
    [4,3,5, 2,6,9, 7,8,1],
    [6,8,2, 5,7,1, 4,9,3],
    [1,9,7, 8,3,4, 5,6,2],

    [8,2,6, 1,9,5, 3,4,7],
    [3,7,4, 6,8,2, 9,1,5],
    [9,5,1, 7,4,3, 6,2,8],

    [5,1,9, 3,2,6, 8,7,4],
    [2,4,8, 9,5,7, 1,3,6],
    [7,6,3, 4,1,8, 2,5,9]
  ];

  const boardEl = document.getElementById("board");
  const statusEl = document.getElementById("status");
  const okBoxEl = document.getElementById("okBox");
// =====================
// è¨­å®šï¼ˆã“ã“ã ã‘è§¦ã‚Œã°OKï¼‰
// =====================
const LIMIT = 3; // 1æ—¥3å›ã¾ã§ï¼ˆç«¯æœ«ãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
const KEY_PREFIX = "sudokuClearCount"; // localStorageã‚­ãƒ¼ã®ãƒ™ãƒ¼ã‚¹
const COUPON_SHOW_TIMEOUT_MIN = 15; // okBoxè¡¨ç¤ºã‹ã‚‰15åˆ†ã§å¼·åˆ¶çµ‚äº†
const COUPON_ACTIVE_TIMEOUT_MIN = 5; // ã‚¹ãƒ©ã‚¤ãƒ‰æœ‰åŠ¹åŒ–å¾Œ5åˆ†ã§å¤±åŠ¹ï¼ˆãƒ—ãƒ­ä»•æ§˜ï¼‰
const AUTH_REFRESH_SEC = 10; // èªè¨¼ç•ªå·æ›´æ–°ï¼ˆç§’ï¼‰

// =====================
// DOM
// =====================
const boardEl = document.getElementById("board");
const statusEl = document.getElementById("status");
const okBoxEl = document.getElementById("okBox");

const randEl = document.getElementById("randNum");
const issueDateEl = document.getElementById("issueDate");
const dayCodeEl = document.getElementById("dayCode");
const clockEl = document.getElementById("liveClock");

// ã‚¹ãƒ©ã‚¤ãƒ‰UIï¼ˆokBoxè¡¨ç¤ºæ™‚ã«åˆæœŸåŒ–ï¼‰
let slider = null;
let unlockMsg = null;

// =====================
// æ—¥ä»˜é–¢é€£ï¼ˆ1æ—¥ã”ã¨ã«ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã‚’åˆ†ã‘ã‚‹ï¼‰
// =====================
function ymdKey(){
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,"0");
  const day = String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${day}`;
}
function countKey(){
  return `${KEY_PREFIX}:${ymdKey()}`;
}

// =====================
// ãƒ­ãƒ¼ã‚«ãƒ«å›æ•°åˆ¶é™
// =====================
function getCount(){
  return parseInt(localStorage.getItem(countKey()) || "0", 10);
}
function addCount(){
  const c = getCount() + 1;
  localStorage.setItem(countKey(), String(c));
  return c;
}

// =====================
// ã‚¯ãƒ¼ãƒãƒ³ï¼šã‚¿ã‚¤ãƒãƒ¼ç¾¤
// =====================
let authTimer = null;
let showTimeoutTimer = null;    // okBoxè¡¨ç¤ºã‹ã‚‰15åˆ†
let activeTimeoutTimer = null;  // ã‚¹ãƒ©ã‚¤ãƒ‰æœ‰åŠ¹åŒ–å¾Œ5åˆ†

function stopAllTimers(){
  if(authTimer){ clearInterval(authTimer); authTimer = null; }
  if(showTimeoutTimer){ clearTimeout(showTimeoutTimer); showTimeoutTimer = null; }
  if(activeTimeoutTimer){ clearTimeout(activeTimeoutTimer); activeTimeoutTimer = null; }
}

function generateCode(){
  return Math.floor(100000 + Math.random() * 900000);
}

function startAuthRefresh(){
  if(!randEl) return;
  randEl.textContent = generateCode();
  if(authTimer) clearInterval(authTimer);
  authTimer = setInterval(()=>{
    if(okBoxEl && okBoxEl.style.display === "block"){
      randEl.textContent = generateCode();
    }
  }, AUTH_REFRESH_SEC * 1000);
}

// okBoxè¡¨ç¤ºã‹ã‚‰15åˆ†ã§æ¶ˆã™
function startShowTimeout(){
  if(showTimeoutTimer) clearTimeout(showTimeoutTimer);
  showTimeoutTimer = setTimeout(()=>{
    hideCoupon("æ™‚é–“åˆ‡ã‚Œã‚„ã§ã€‚ã¾ãŸãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦ãªï¼");
  }, COUPON_SHOW_TIMEOUT_MIN * 60 * 1000);
}

// ã‚¹ãƒ©ã‚¤ãƒ‰ã§æœ‰åŠ¹åŒ–ã•ã‚ŒãŸã‚‰5åˆ†ã§å¤±åŠ¹ï¼ˆãƒ—ãƒ­ä»•æ§˜ï¼‰
function startActiveTimeout(){
  if(activeTimeoutTimer) clearTimeout(activeTimeoutTimer);
  activeTimeoutTimer = setTimeout(()=>{
    hideCoupon("ã‚¯ãƒ¼ãƒãƒ³ã®æœ‰åŠ¹æ™‚é–“ãŒåˆ‡ã‚ŒãŸã§ã€‚æ¬¡ã¾ãŸã‚ˆã‚ã—ãã§ï¼");
  }, COUPON_ACTIVE_TIMEOUT_MIN * 60 * 1000);
}

function hideCoupon(msg){
  stopAllTimers();
  okBoxEl.style.display = "none";
  if(msg) statusEl.textContent = msg;
}

// =====================
// ä¸Šé™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
// â€» okBoxã®ä¸­èº«ã‚’æ›¸ãæ›ãˆã‚‹æ–¹å¼ã¯ã€å…ƒUIãŒæ¶ˆãˆã‚‹ã®ã§
//   ã“ã“ã¯ã€ŒokBoxã¯ãã®ã¾ã¾ä½¿ã£ã¦ã€è¡¨ç¤ºã™ã‚‹
// =====================
function showLimitMessage(c){
  stopAllTimers();
  okBoxEl.style.display = "block";

  okBoxEl.innerHTML = `
    <div class="couponBox">
      <p class="okTitle">âš ï¸ æœ¬æ—¥ã®ã”åˆ©ç”¨ä¸Šé™ã§ã™</p>
      <div style="margin-top:10px">
        ã“ã®ç«¯æœ«ã¯<strong>${c}å›</strong>ã‚¯ãƒªã‚¢æ¸ˆã¿ã€‚<br>
        ã“ã‚Œä»¥ä¸Šã¯å¾€ç”Ÿã—ã¾ã£ã›ã€œã€ã¾ãŸæ©Ÿä¼šã‚ã‚Œã°ã‚ˆã‚ã—ãã§ï¼
      </div>
      <div class="small" style="margin-top:10px">
        â€»ã”ä¸æ˜ãªå ´åˆã¯ã‚¹ã‚¿ãƒƒãƒ•ã¾ã§
      </div>
    </div>
  `;
}

// =====================
// æ—¥ä»˜ãƒ»æ™‚è¨ˆãƒ»æœ¬æ—¥ã®ã‚³ãƒ¼ãƒ‰
// =====================
function pad(n){ return String(n).padStart(2,"0"); }

function setupDateClock(){
  const now = new Date();
  if(issueDateEl) issueDateEl.textContent = now.toLocaleDateString();

  // æœ¬æ—¥ã®ã‚³ãƒ¼ãƒ‰ï¼šAã€œFï¼ˆæ—¥ä»˜ã§æ±ºã¾ã‚‹ï¼‰
  function getDayCode(){
    const d = new Date();
    const patterns = ["A","B","C","D","E","F"];
    const idx = (d.getFullYear() + d.getMonth() + d.getDate()) % patterns.length;
    return patterns[idx];
  }
  if(dayCodeEl) dayCodeEl.textContent = getDayCode();

  // æ™‚è¨ˆ
  if(clockEl){
    setInterval(()=>{
      const d = new Date();
      clockEl.textContent = `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }, 200);
  }
}

// =====================
// ã‚¹ãƒ©ã‚¤ãƒ‰UIåˆæœŸåŒ–
// =====================
function initSlider(){
  slider = document.getElementById("unlockSlider");
  unlockMsg = document.getElementById("unlockMsg");

  if(!slider || !unlockMsg) return;

  slider.value = 0;
  unlockMsg.textContent = "ã‚¹ãƒ©ã‚¤ãƒ‰ã§æœ‰åŠ¹åŒ–ã—ã¦ãª";
  unlockMsg.style.color = "#888";

  slider.oninput = () => {
    if(slider.value == 100){
      unlockMsg.textContent = "âœ” ã‚¯ãƒ¼ãƒãƒ³æœ‰åŠ¹ã‚„ã§ï¼ï¼ˆ5åˆ†ä»¥å†…ã«ãƒ¬ã‚¸ã¸ï¼‰";
      unlockMsg.style.color = "green";
      startActiveTimeout(); // â˜…ãƒ—ãƒ­ä»•æ§˜ï¼šã‚¹ãƒ©ã‚¤ãƒ‰å¾Œ5åˆ†ã§å¤±åŠ¹
    }
  };
}

// =====================
// ã‚¯ãƒ¼ãƒãƒ³è¡¨ç¤ºï¼ˆå…±é€šï¼‰
// =====================
function showCoupon(){
  statusEl.textContent = "";
  okBoxEl.style.display = "block";

  // èªè¨¼ç•ªå·ï¼†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆé–‹å§‹
  startAuthRefresh();
  startShowTimeout();

  // ã‚¹ãƒ©ã‚¤ãƒ‰UIåˆæœŸåŒ–
  initSlider();

  okBoxEl.scrollIntoView({behavior:"smooth", block:"start"});
}

// =====================
// ç›¤é¢ç”Ÿæˆï¼ˆã‚ãªãŸã®puzzle/solutionã‚’ãã®ã¾ã¾ä½¿ã†ï¼‰
// =====================

// ===== ã‚µãƒ³ãƒ—ãƒ«å•é¡Œï¼ˆ0ã¯ç©ºæ¬„ï¼‰ =====
const puzzle = [
  [0,0,0, 2,6,0, 7,0,1],
  [6,8,0, 0,7,0, 0,9,0],
  [1,9,0, 0,0,4, 5,0,0],

  [8,2,0, 1,0,0, 0,4,0],
  [0,0,4, 6,0,2, 9,0,0],
  [0,5,0, 0,0,3, 0,2,8],

  [0,0,9, 3,0,0, 0,7,4],
  [0,4,0, 0,5,0, 0,3,6],
  [7,0,3, 0,1,8, 0,0,0]
];

const solution = [
  [4,3,5, 2,6,9, 7,8,1],
  [6,8,2, 5,7,1, 4,9,3],
  [1,9,7, 8,3,4, 5,6,2],

  [8,2,6, 1,9,5, 3,4,7],
  [3,7,4, 6,8,2, 9,1,5],
  [9,5,1, 7,4,3, 6,2,8],

  [5,1,9, 3,2,6, 8,7,4],
  [2,4,8, 9,5,7, 1,3,6],
  [7,6,3, 4,1,8, 2,5,9]
];

const inputs = [];

function buildBoard(){
  boardEl.innerHTML = "";
  inputs.length = 0;

  for(let r=0;r<9;r++){
    inputs[r]=[];
    for(let c=0;c<9;c++){
      const cell = document.createElement("div");
      cell.className = "cell";
      if (c % 3 === 0) cell.classList.add("thickL");
      if (c % 3 === 2) cell.classList.add("thickR");
      if (r % 3 === 0) cell.classList.add("thickT");
      if (r % 3 === 2) cell.classList.add("thickB");

      const inp = document.createElement("input");
      inp.setAttribute("inputmode","numeric");
      inp.setAttribute("maxlength","1");
      inp.setAttribute("aria-label", `r${r+1}c${c+1}`);
      inp.dataset.r = r;
      inp.dataset.c = c;

      const v = puzzle[r][c];
      if(v !== 0){
        inp.value = String(v);
        inp.disabled = true;
        inp.classList.add("given");
      } else {
        inp.addEventListener("input", (e)=>{
          const x = e.target.value.replace(/[^1-9]/g,"");
          e.target.value = x;
          e.target.classList.remove("err");
          // å…¥åŠ›ã‚ã£ãŸã‚‰ã‚¯ãƒ¼ãƒãƒ³æ¶ˆã—ã¦çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
          okBoxEl.style.display = "none";
          statusEl.textContent = "";
          stopAllTimers();
        });
      }

      cell.appendChild(inp);
      boardEl.appendChild(cell);
      inputs[r][c] = inp;
    }
  }
}

function getUserGrid(){
  const g = Array.from({length:9},()=>Array(9).fill(0));
  for(let r=0;r<9;r++){
    for(let c=0;c<9;c++){
      const val = inputs[r][c].value.trim();
      g[r][c] = val ? Number(val) : 0;
    }
  }
  return g;
}

function isComplete(user){
  for(let r=0;r<9;r++){
    for(let c=0;c<9;c++){
      if(user[r][c] === 0) return false;
    }
  }
  return true;
}

function markErrors(user){
  let hasErr = false;
  for(let r=0;r<9;r++){
    for(let c=0;c<9;c++){
      const inp = inputs[r][c];
      if(inp.disabled) continue;
      inp.classList.remove("err");
      const val = user[r][c];
      if(val !== 0 && val !== solution[r][c]){
        inp.classList.add("err");
        hasErr = true;
      }
    }
  }
  return hasErr;
}

function isSolved(user){
  for(let r=0;r<9;r++){
    for(let c=0;c<9;c++){
      if(user[r][c] !== solution[r][c]) return false;
    }
  }
  return true;
}

// =====================
// ãƒœã‚¿ãƒ³
// =====================
document.getElementById("checkBtn").addEventListener("click", ()=>{
  const user = getUserGrid();

  if(!isComplete(user)){
    statusEl.textContent = "ã¾ã ç©ºæ¬„ãŒã‚ã‚‹ã§ã€‚å…¨éƒ¨åŸ‹ã‚ã¦ã‹ã‚‰ãƒã‚§ãƒƒã‚¯ã—ã¦ãªã€‚";
    okBoxEl.style.display = "none";
    stopAllTimers();
    return;
  }

  const hasErr = markErrors(user);
  if(hasErr){
    statusEl.textContent = "æƒœã—ã„ï¼èµ¤ã„ãƒã‚¹ãŒé–“é•ã„ã®å¯èƒ½æ€§é«˜ã„ã§ã€‚ãã“ç›´ã—ã¦ã¿ã¦ã€‚";
    okBoxEl.style.display = "none";
    stopAllTimers();
    return;
  }

  if(isSolved(user)){
    const count = addCount();
    if(count > LIMIT){
      showLimitMessage(count);
      return;
    }
    showCoupon();
  } else {
    statusEl.textContent = "ã©ã“ã‹é•ã†ã¿ãŸã„ã‚„ã€‚ã‚‚ã†ä¸€å›è¦‹ç›´ã—ï¼";
    okBoxEl.style.display = "none";
    stopAllTimers();
  }
});

document.getElementById("resetBtn").addEventListener("click", ()=>{
  stopAllTimers();
  for(let r=0;r<9;r++){
    for(let c=0;c<9;c++){
      const inp = inputs[r][c];
      if(inp.disabled) continue;
      inp.value = "";
      inp.classList.remove("err");
    }
  }
  statusEl.textContent = "";
  okBoxEl.style.display = "none";
});

document.getElementById("hintBtn").addEventListener("click", ()=>{
  const user = getUserGrid();
  const empties = [];
  for(let r=0;r<9;r++){
    for(let c=0;c<9;c++){
      if(!inputs[r][c].disabled && user[r][c] === 0){
        empties.push([r,c]);
      }
    }
  }
  if(empties.length === 0){
    statusEl.textContent = "ã‚‚ã†ç©ºæ¬„ãªã„ã§ã€‚å®Œæˆãƒã‚§ãƒƒã‚¯æŠ¼ã—ã¦ãªã€‚";
    return;
  }
  const [r,c] = empties[Math.floor(Math.random()*empties.length)];
  inputs[r][c].value = String(solution[r][c]);
  inputs[r][c].classList.remove("err");
  statusEl.textContent = "ãƒ’ãƒ³ãƒˆå…¥ã‚ŒãŸã§ï¼ˆ1ãƒã‚¹ï¼‰ã€‚";
  okBoxEl.style.display = "none";
  stopAllTimers();
});

</script>
</body>
</html>
